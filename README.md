# college-uni
Demo on Identity on ASP.NET Core and EF Core

Note this is strictly a demo of the Web API. No client side views are demonstrated here.

## Features
* Optimistic Concurrency
  * See src/CollegeUni.Data/EntityFrameworkCore/DbContextExtensions.cs
  * src/CollegeUni.Data/EntityFrameworkCore/ConcurrencyHelper.cs
* Repository & Unit of Work pattern - a layer of abstration between the data and business layer to help facilitate unit testing or TDD.
  * src/CollegeUni.Data/EntityFrameworkCore/GenericRepo.cs
  * src/CollegeUni.Data/EntityFrameworkCore/UnitOfWork.cs
* Boilerplate for Service layer & API layer for handling typical CRUD requests
  * Legacy based login & JWT Auth Support
  * REST API doc generator via Swagger
  * Validation model error response & Exception handling
  * Pagination for 'BrowseRequests'
  * Unit testing examples
    * test/UnitTests/CollegeUni.Api.Test/AccountControllerTests.cs 

## Requirements
Install the .NET Core 2.0 SDK (x64 installer)
[https://www.microsoft.com/net/download/core]

SQL Server Express is used for the database.
[https://www.microsoft.com/en-us/download/details.aspx?id=55994]

## Build and Run

In Visual Studio open the solution explorer ensure the CollegeUni project is set as the startup project.

Build the solution (VS should automatically have nuget packages are restored).

Hit F5 to run in debug mode.

On initial startup the app will run migrations. Behind the scenes this will create the database CollegeUni in your localhost/SQLEXPRESS and also the database schema/tables and some seeded data.

## Using the app through Swagger
Goto [http://petstore.swagger.io] and enter in the url of the hosted swagger json file and click 'Explore'. This is generated by the demo app. The url will look something like this: `http://localhost:52668/swagger/v1/swagger.json`

### Registering a User
To create a user goto the section `/api/Account/register` and click 'Try it out'

Enter in a user data in the following format in the text are to define the request model:
```
{
  "email": "username@domain.com",
  "password": "Password0",
  "confirmPassword": "Password0"
}
```
Click 'Execute'. A user should have been successfully registered.

### Getting a access token.
Now goto `/api/Account/token` and reenter the credentials and click 'Execute'.
You should have seen a 200 OK response with the token:
```
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZWFmOGEwNC0xYzc1LTRkMzAtYjY1YS0wNzIxODNhOTFjMTIiLCJzdWIiOiJqc2hpbkBuYXBhLmNvbSIsImV4cCI6MTUwOTEyNTAxNSwiaXNzIjoiaHR0cHM6Ly9BdXRoQ29sbGVnZVVuaS8iLCJhdWQiOiJodHRwczovL0F1dGhDb2xsZWdlVW5pLyJ9.SgnQj3yKGsc6Y12hOrP-HtKwMmJj9-9taVoLMqK1WOA",
  "expiration": "2017-10-27T17:23:35Z"
}
```

### Accessing an authorized endpoint using an access token.
Now let's try an endpoint that requires the JWT Bearer Authorization. Goto `/api/Course` and enter in the access token you just received under that `Authorization` parameter. It should look similar to this:
`Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZWFmOGEwNC0xYzc1LTRkMzAtYjY1YS0wNzIxODNhOTFjMTIiLCJzdWIiOiJqc2hpbkBuYXBhLmNvbSIsImV4cCI6MTUwOTEyNTAxNSwiaXNzIjoiaHR0cHM6Ly9BdXRoQ29sbGVnZVVuaS8iLCJhdWQiOiJodHRwczovL0F1dGhDb2xsZWdlVW5pLyJ9.SgnQj3yKGsc6Y12hOrP-HtKwMmJj9-9taVoLMqK1WOA`

Hit 'Execute' and you should have gotten your first authorized response!
